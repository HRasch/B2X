# Pinia 2.x → 3.x Migration Guide

**DocID**: KB-PINIA-3  
**Created**: 7. Januar 2026  
**Status**: Research Complete  
**Sources**: Official Pinia documentation, GitHub CHANGELOG, npm package info

## Quick Summary

Pinia 3.0 is a "boring" major release with **no new features** — it drops Vue 2 support and removes deprecated APIs. For most Vue 3 users already on Pinia 2.3.x, the migration should require minimal to no code changes.

## Breaking Changes

| Change | Pinia 2.x | Pinia 3.x | Migration |
|--------|-----------|-----------|-----------|
| Vue 2 Support | ✅ Supported | ❌ Removed | Use Vue 3 only |
| `defineStore({ id: 'x' })` | ⚠️ Deprecated | ❌ Removed | Use `defineStore('x', {...})` |
| `PiniaStorePlugin` type | ⚠️ Deprecated | ❌ Removed | Use `PiniaPlugin` instead |
| `_Awaited` internal type | Available | ❌ Removed | Uses native TS `Awaited` |
| Package format | CommonJS default | ESM (`type: module`) | CJS dist files still provided |
| DevTools API | v6 | v7 | Update Vue DevTools |
| iife DevTools bundle | Included | ❌ Removed | Must include manually |

### Detailed Migration Steps

#### 1. `defineStore` Syntax
```typescript
// ❌ Pinia 2.x deprecated (removed in 3.x)
defineStore({
  id: 'storeName',
  state: () => ({ count: 0 }),
})

// ✅ Pinia 3.x (and 2.x recommended)
defineStore('storeName', {
  state: () => ({ count: 0 }),
})
```

#### 2. Plugin Type Alias
```typescript
// ❌ Pinia 2.x deprecated
import type { PiniaStorePlugin } from 'pinia'

// ✅ Pinia 3.x
import type { PiniaPlugin } from 'pinia'
```

## New Features

Pinia 3.0 contains **no new features**. All improvements are in preparation and dependency updates:

- **Native TypeScript `Awaited`**: Uses TS 4.5+ native type instead of internal polyfill
- **ESM-first package**: Published as `type: module` (CJS still available)
- **DevTools v7**: Upgraded to latest Vue DevTools API
- **Server-side warnings**: Improved detection of global context usage on server

## Version Requirements

| Dependency | Minimum Version | Notes |
|------------|-----------------|-------|
| **Vue** | 3.0+ | Vue 2 no longer supported |
| **TypeScript** | 4.5+ | Required for native `Awaited` type |
| **Vue DevTools** | v7 | v6 DevTools API deprecated |
| **Node.js** | 16+ | ESM support required |

## Nuxt Integration

### @pinia/nuxt Version Matrix

| Pinia Version | @pinia/nuxt Version | Nuxt Support |
|---------------|---------------------|--------------|
| 2.3.x | 0.5.x - 0.9.x | Nuxt 2 (Bridge), Nuxt 3 |
| **3.0.x** | **0.10.x - 0.11.x** | **Nuxt 3, Nuxt 4** |

### @pinia/nuxt 0.11.x Changes

1. **Nuxt 4 Support** (v0.11.1+):
   ```typescript
   // nuxt.config.ts - Nuxt 4 compatible
   export default defineNuxtConfig({
     modules: ['@pinia/nuxt'],
     pinia: {
       // Nuxt 4: stores in app/stores (not ./app/stores)
       storesDirs: ['./stores/**'],
     },
   })
   ```

2. **Automatic HMR** (v0.11.3): Vite-only automatic HMR code generation

3. **ESM-only** (v0.11.0+): Module is now ESM-only

4. **Layer auto-imports fixed** (v0.11.3): 
   ```typescript
   // Before v0.11.3
   storesDirs: ['./app/stores/**']
   
   // After v0.11.3 (layers work correctly)
   storesDirs: ['./stores/**']
   ```

### Auto-imports in @pinia/nuxt

The module auto-imports:
- `usePinia()` - Get Pinia instance
- `defineStore()` - Define stores
- `storeToRefs()` - Extract reactive refs
- `acceptHMRUpdate()` - HMR support
- All stores in `stores/` directory (or `app/stores/` in Nuxt 4)

## TypeScript Changes

### Type Improvements
- Native `Awaited` type usage (TS 4.5+)
- Stricter type inference for stores
- Improved `storeToRefs()` typing for writable computed refs

### Breaking Type Changes
```typescript
// PiniaStorePlugin removed - use PiniaPlugin
import type { PiniaPlugin } from 'pinia'

// Store type is now stricter
// Use StoreGeneric for any store type
import type { StoreGeneric } from 'pinia'
function takeAnyStore(store: StoreGeneric) {}
```

## Migration Checklist

- [ ] Verify Vue 3.0+ is installed
- [ ] Verify TypeScript 4.5+ (if using TypeScript)
- [ ] Search for `defineStore({ id:` and convert to `defineStore('id',`
- [ ] Replace `PiniaStorePlugin` with `PiniaPlugin`
- [ ] Update `@pinia/nuxt` to 0.10.x+ (for Pinia 3)
- [ ] Update Vue DevTools to v7
- [ ] Test SSR if applicable (global context warnings)
- [ ] Review custom Pinia plugins for type compatibility
- [ ] Run full test suite

### Search Commands for Deprecated Patterns

```bash
# Find deprecated defineStore syntax
grep -r "defineStore({" --include="*.ts" --include="*.vue"
grep -r "id:" --include="*.ts" -A1 | grep "defineStore"

# Find deprecated type
grep -r "PiniaStorePlugin" --include="*.ts"
```

## DevTools Support Changes

### Breaking: iife Bundle Removed

The Vue DevTools integration is no longer included in the iife build. If you use iife bundles:

```html
<!-- Must manually include devtools for iife usage -->
<script src="path/to/vue-devtools.js"></script>
<script src="path/to/pinia.iife.js"></script>
```

### DevTools v7 Features
- Better store inspection
- Improved action grouping
- Enhanced state editing
- Store reset from inspector

## Risks & Mitigations

| Risk | Impact | Mitigation |
|------|--------|------------|
| Vue 2 projects blocked | High | Stay on Pinia 2.3.x or migrate to Vue 3 |
| TypeScript < 4.5 incompatible | Medium | Upgrade TypeScript first |
| Old DevTools not working | Low | Update Vue DevTools extension |
| ESM import issues | Low | Most bundlers handle both formats |
| Nuxt 2 incompatible | High | Stay on @pinia/nuxt 0.9.x |
| Custom plugin type errors | Low | Update type imports |

## B2Connect Impact Assessment

### Current State (Verified 2026-01-07)

| Package | Location | Current Version | Target Version |
|---------|----------|-----------------|----------------|
| `pinia` | Admin | `^2.2.6` | `^3.0.4` |
| `pinia` | Store | `^2.2.6` | `^3.0.4` |
| `pinia` | Management | `^2.2.6` | `^3.0.4` |
| `@pinia/nuxt` | Store (Nuxt) | `^0.4.11` | `^0.11.3` |

### Codebase Analysis Results

- ✅ **No deprecated `defineStore({ id:` syntax found** — All stores use modern setup syntax
- ✅ **No `PiniaStorePlugin` type usage found** — Clean codebase
- ✅ **All stores use composition API style** — Best practice already followed
- ⚠️ **@pinia/nuxt outdated** — v0.4.11 is significantly behind (missing Nuxt 4 support)

### Stores Found (using modern syntax)
- `frontend/Store/src/stores/`: auth, tenant, categories, cart, user
- `frontend/Admin/src/stores/`: catalog, users, jobs, theme, pageBuilder, shop

### Recommended Actions
1. ✅ Codebase already follows Pinia 3.x conventions
2. ⚠️ **Priority**: Update `@pinia/nuxt` from 0.4.11 → 0.11.3 (required for Nuxt 4)
3. Upgrade `pinia` from 2.2.6 → 3.0.4 across all frontends
4. Test SSR hydration in Store frontend

## Recommendation

**✅ PROCEED** — Recommended for B2Connect

### Rationale
1. **Minimal breaking changes**: Most codebases need no changes
2. **Future-proof**: Aligns with Vue 3 ecosystem
3. **Better DevTools**: v7 API provides improved DX
4. **Nuxt 4 ready**: Required for Nuxt 4 compatibility
5. **No functional changes**: Same API, fewer deprecated options

### Suggested Approach
1. First upgrade TypeScript to 5.x if not already
2. Fix any deprecated `defineStore` syntax in codebase
3. Upgrade Pinia to 3.x
4. Upgrade @pinia/nuxt to 0.11.x
5. Run full test suite
6. Verify DevTools connectivity

## References

- [Official Migration Guide](https://pinia.vuejs.org/cookbook/migration-v2-v3.html)
- [Pinia 3.0 Release Notes](https://github.com/vuejs/pinia/releases/tag/v3.0.0)
- [Pinia CHANGELOG](https://github.com/vuejs/pinia/blob/v3/packages/pinia/CHANGELOG.md)
- [@pinia/nuxt CHANGELOG](https://github.com/vuejs/pinia/blob/v3/packages/nuxt/CHANGELOG.md)
- [Nuxt Pinia Documentation](https://pinia.vuejs.org/ssr/nuxt.html)

---

**Related KB Articles:**
- [KB-NUXT-4](../nuxt/3.x--to--4.x.md) - Nuxt 3 to 4 Migration Guide
- [KB-VUE-3] - Vue 3 Ecosystem Overview (if exists)

**Maintained by**: @Architect  
**Last Updated**: 7. Januar 2026
