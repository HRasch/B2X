using B2Connect.Types.DTOs.Auth;
using FluentValidation;

namespace B2Connect.Infrastructure.Validation;

/// <summary>
/// Validator for LoginRequest to prevent injection attacks and ensure data integrity.
/// Validates email format, password strength, and field length constraints.
/// </summary>
public class LoginRequestValidator : AbstractValidator<LoginRequest>
{
    public LoginRequestValidator()
    {
        // Email validation
        RuleFor(x => x.Email)
            .NotEmpty()
            .WithMessage("Email is required")
            .WithErrorCode("FIELD_REQUIRED")
            .EmailAddress()
            .WithMessage("Email must be a valid email address")
            .WithErrorCode("INVALID_FORMAT")
            .MaximumLength(255)
            .WithMessage("Email must not exceed 255 characters")
            .WithErrorCode("FIELD_TOO_LONG");

        // Password validation
        RuleFor(x => x.Password)
            .NotEmpty()
            .WithMessage("Password is required")
            .WithErrorCode("FIELD_REQUIRED")
            .MinimumLength(6)
            .WithMessage("Password must be at least 6 characters")
            .WithErrorCode("FIELD_TOO_SHORT")
            .MaximumLength(128)
            .WithMessage("Password must not exceed 128 characters")
            .WithErrorCode("FIELD_TOO_LONG")
            .Matches(@"^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};':"",.<>?\\/]*$")
            .WithMessage("Password contains invalid characters. Only alphanumeric and common special characters are allowed")
            .WithErrorCode("INVALID_CHARACTER_SET");

        // Optional TenantId validation
        RuleFor(x => x.TenantId)
            .Must(x => x == null || (x != Guid.Empty))
            .WithMessage("TenantId must be a valid GUID or null")
            .WithErrorCode("INVALID_GUID")
            .When(x => x.TenantId.HasValue);
    }
}
