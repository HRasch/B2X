# ? ASPIRE + DOCKER FRONTENDS - VOLLSTÄNDIGE LÖSUNG

## ?? Status

? **Native Aspire JavaScript Integration** - `AddViteApp` für Development  
? **Docker Compose** - Für Development & Production  
? **Dockerfiles** - Mit Development & Production Targets  
? **Nginx Config** - Für Production SPA Routing  

---

## ?? Zwei Wege die Frontends zu starten

### Option A: Aspire Native (EMPFOHLEN für Development)

Aspire läuft npm direkt auf dem Host für **besseres Hot-Reload**:

```bash
cd AppHost
dotnet run
```

**Vorteile:**
- ? Echtes Hot-Reload (schnellste Änderungen)
- ? Alles im Aspire Dashboard
- ? Keine Docker-Abhängigkeit für Frontends
- ? Native Source Maps & Debugging

### Option B: Docker Compose (Für Containerisierung)

Alle Services in Docker (inkl. Frontends):

```bash
docker-compose up -d
```

**Vorteile:**
- ? Identisch zu Production
- ? Isolierte Umgebung
- ? Keine lokale npm Installation nötig
- ? Team-konsistent

---

## ?? Dateien & Konfiguration

### Aspire Integration

**AppHost/Program.cs:**
```csharp
// Native AddViteApp von Aspire.Hosting.JavaScript
var frontendStore = builder
    .AddViteApp("frontend-store", "../Frontend/Store")
    .WithHttpEndpoint(port: 5173, env: "VITE_PORT")
    .WithEnvironment("VITE_API_GATEWAY_URL", "http://localhost:8000");

var frontendAdmin = builder
    .AddViteApp("frontend-admin", "../Frontend/Admin")
    .WithHttpEndpoint(port: 5174, env: "VITE_PORT")
    .WithEnvironment("VITE_API_GATEWAY_URL", "http://localhost:8080");
```

### Docker Configuration

**Frontend/Store/Dockerfile:**
```dockerfile
# Development Stage (für docker-compose)
FROM node:20-alpine AS development
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "5173"]

# Production Stage (für Deployment)
FROM nginx:alpine AS production
COPY --from=builder /app/dist /usr/share/nginx/html
```

**docker-compose.yml:**
```yaml
frontend-store:
  build:
    context: ./Frontend/Store
    target: development  # oder: production
  volumes:
    - ./Frontend/Store:/app  # Hot-reload
    - /app/node_modules      # Preserve node_modules
```

---

## ??? Architecture

```
???????????????????????????????????????????????????????????
?                    DEVELOPMENT                           ?
???????????????????????????????????????????????????????????
?                                                          ?
?  OPTION A: Aspire Native                                 ?
?  ???????????????????????????????????????????????????    ?
?  ? AppHost startet npm direkt                      ?    ?
?  ? ? Hot-reload auf Host                           ?    ?
?  ? ? Frontends im Aspire Dashboard                 ?    ?
?  ???????????????????????????????????????????????????    ?
?                                                          ?
?  OPTION B: Docker Compose                                ?
?  ???????????????????????????????????????????????????    ?
?  ? Frontends in Docker Containern                  ?    ?
?  ? ? Volume mounts für Hot-reload                  ?    ?
?  ? ? Isolierte Umgebung                            ?    ?
?  ???????????????????????????????????????????????????    ?
?                                                          ?
???????????????????????????????????????????????????????????
?                    PRODUCTION                            ?
???????????????????????????????????????????????????????????
?  ???????????????????????????????????????????????????    ?
?  ? Docker mit Nginx                                ?    ?
?  ? ? Production Build (npm run build)              ?    ?
?  ? ? SPA Routing mit nginx.conf                    ?    ?
?  ? ? Gzip Compression                              ?    ?
?  ???????????????????????????????????????????????????    ?
?                                                          ?
???????????????????????????????????????????????????????????
```

---

## ?? Service-Übersicht

| Service | Aspire Native | Docker Compose | Port |
|---------|--------------|----------------|------|
| postgres | Docker Container | Docker Container | 5432 |
| redis | Docker Container | Docker Container | 6379 |
| elasticsearch | Docker Container | Docker Container | 9200 |
| rabbitmq | Docker Container | Docker Container | 5672 |
| auth-service | .NET Process | Docker Container | 7002 |
| catalog-service | .NET Process | Docker Container | 7005 |
| store-gateway | .NET Process | Docker Container | 8000 |
| admin-gateway | .NET Process | Docker Container | 8080 |
| **frontend-store** | **npm Process** | **Docker Container** | **5173** |
| **frontend-admin** | **npm Process** | **Docker Container** | **5174** |

---

## ?? Erstelle/Aktualisierte Dateien

### Dockerfiles (aktualisiert)
- ? `Frontend/Store/Dockerfile` - Development + Production Stages
- ? `Frontend/Admin/Dockerfile` - Development + Production Stages

### Nginx Config (neu)
- ? `Frontend/Store/nginx.conf` - SPA Routing für Production
- ? `Frontend/Admin/nginx.conf` - SPA Routing für Production

### Aspire Integration
- ? `AppHost/Program.cs` - Native AddViteApp
- ? `Directory.Packages.props` - Aspire.Hosting.JavaScript

---

## ?? Schnellstart

### Development mit Aspire (EMPFOHLEN)

```bash
# 1. npm install (einmalig pro Frontend)
cd Frontend/Store && npm install
cd Frontend/Admin && npm install

# 2. AppHost starten
cd AppHost && dotnet run

# 3. Öffnen
# Dashboard: http://localhost:15500
# Store: http://localhost:5173
# Admin: http://localhost:5174
```

### Development mit Docker

```bash
# Alles starten
docker-compose up -d

# Logs verfolgen
docker-compose logs -f frontend-store frontend-admin

# Öffnen
# Store: http://localhost:5173
# Admin: http://localhost:5174
```

### Production Build

```bash
# Production Images bauen
docker-compose build --target production

# Oder einzeln:
docker build -t b2connect-frontend-store:prod --target production ./Frontend/Store
docker build -t b2connect-frontend-admin:prod --target production ./Frontend/Admin
```

---

## ? Verifikation

```bash
# 1. Aspire Native funktioniert?
cd AppHost && dotnet run
# ? Dashboard zeigt frontend-store und frontend-admin

# 2. Docker funktioniert?
docker-compose up -d frontend-store frontend-admin
# ? Container laufen: docker-compose ps

# 3. Frontends erreichbar?
curl http://localhost:5173
curl http://localhost:5174
# ? HTML Response
```

---

## ?? Zusammenfassung

Sie haben jetzt **zwei vollständig funktionierende Optionen**:

1. **Aspire Native** (`AddViteApp`) - Für schnelles Development mit echtem Hot-Reload
2. **Docker Compose** - Für Container-basierte Entwicklung und Production

**Beide Optionen sind vollständig konfiguriert und einsatzbereit!** ??

---

## ?? Weitere Dokumentation

- `ASPIRE_JAVASCRIPT_NATIVE_FINAL.md` - Details zur Aspire Integration
- `docker-compose.yml` - Docker Service Definitionen
- `Frontend/*/Dockerfile` - Multi-stage Build Konfiguration
- `Frontend/*/nginx.conf` - Production SPA Routing
