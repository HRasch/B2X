name: Dependency Updates

on:
  schedule:
    # Run weekly on Mondays at 8 AM UTC
    - cron: '0 8 * * 1'
  workflow_dispatch: # Allow manual triggering

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        frontend: [Store, Admin, Management]

    steps:
    - uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v6
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: frontend/${{ matrix.frontend }}/package-lock.json

    - name: Install dependencies
      run: npm ci
      working-directory: frontend/${{ matrix.frontend }}

    - name: Update dependencies
      run: npm update
      working-directory: frontend/${{ matrix.frontend }}

    - name: Run tests after update
      run: npm run test:coverage
      working-directory: frontend/${{ matrix.frontend }}

    - name: Run type check after update
      run: npm run type-check
      working-directory: frontend/${{ matrix.frontend }}

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: |
          chore: update dependencies for ${{ matrix.frontend }}

          - Updated npm dependencies
          - Verified tests still pass
          - Verified type checking passes
        title: 'chore: update dependencies for ${{ matrix.frontend }}'
        branch: dependency-updates/${{ matrix.frontend }}
        delete-branch: true
        labels: |
          dependencies
          automated
        body: |
          ## Dependency Updates for ${{ matrix.frontend }}

          This PR updates npm dependencies for the ${{ matrix.frontend }} frontend.

          ### Changes
          - Updated all patch and minor version dependencies
          - Verified all tests pass
          - Verified TypeScript compilation succeeds

          ### Testing
          - âœ… Unit tests pass
          - âœ… Type checking passes
          - âœ… Build succeeds

          ---
          ðŸ¤– This PR was automatically created by the dependency update workflow.
