// ============================================
// SCSS Mixins - Bootstrap-style Reusable Patterns
// ============================================
// Usage: @use 'abstracts/mixins' as mx;
//        @include mx.button-variant($primary, $primary-dark);
// ============================================

@use 'sass:map';
@use 'sass:math';
@use 'functions' as fn;

// --------------------------------------------
// Responsive Breakpoints
// --------------------------------------------

$breakpoints: (
  'sm': 640px,
  'md': 768px,
  'lg': 1024px,
  'xl': 1280px,
  '2xl': 1536px,
) !default;

/// Media query: min-width (mobile-first)
/// @param {String} $breakpoint - Breakpoint name
@mixin media-up($breakpoint) {
  @if map.has-key($breakpoints, $breakpoint) {
    @media (min-width: map.get($breakpoints, $breakpoint)) {
      @content;
    }
  } @else {
    @error "Unknown breakpoint: #{$breakpoint}";
  }
}

/// Media query: max-width
/// @param {String} $breakpoint - Breakpoint name
@mixin media-down($breakpoint) {
  @if map.has-key($breakpoints, $breakpoint) {
    @media (max-width: map.get($breakpoints, $breakpoint) - 0.02px) {
      @content;
    }
  } @else {
    @error "Unknown breakpoint: #{$breakpoint}";
  }
}

/// Media query: between breakpoints
/// @param {String} $lower - Lower breakpoint
/// @param {String} $upper - Upper breakpoint
@mixin media-between($lower, $upper) {
  @if map.has-key($breakpoints, $lower) and map.has-key($breakpoints, $upper) {
    @media (min-width: map.get($breakpoints, $lower)) and (max-width: map.get($breakpoints, $upper) - 0.02px) {
      @content;
    }
  }
}

// --------------------------------------------
// Button Mixins
// --------------------------------------------

/// Generate button variant
/// @param {Color} $background - Background color
/// @param {Color} $border - Border color
/// @param {Color} $color - Text color (auto-calculated if null)
/// @param {Color} $hover-bg - Hover background (auto-calculated if null)
/// @param {Color} $hover-border - Hover border (auto-calculated if null)
/// @param {Color} $active-bg - Active background (auto-calculated if null)
@mixin button-variant(
  $background,
  $border: $background,
  $color: null,
  $hover-bg: null,
  $hover-border: null,
  $active-bg: null
) {
  // Auto-calculate colors if not provided
  $color: if($color, $color, fn.color-contrast($background));
  $hover-bg: if($hover-bg, $hover-bg, fn.shade-color($background, 15%));
  $hover-border: if($hover-border, $hover-border, fn.shade-color($border, 20%));
  $active-bg: if($active-bg, $active-bg, fn.shade-color($background, 25%));

  --btn-bg: #{$background};
  --btn-border: #{$border};
  --btn-color: #{$color};
  --btn-hover-bg: #{$hover-bg};
  --btn-hover-border: #{$hover-border};
  --btn-hover-color: #{fn.color-contrast($hover-bg)};
  --btn-active-bg: #{$active-bg};
  --btn-active-border: #{fn.shade-color($border, 25%)};
  --btn-active-color: #{fn.color-contrast($active-bg)};
  --btn-disabled-bg: #{fn.tint-color($background, 50%)};
  --btn-disabled-border: #{fn.tint-color($border, 50%)};
  --btn-disabled-color: #{fn.color-contrast(fn.tint-color($background, 50%))};

  background-color: var(--btn-bg);
  border-color: var(--btn-border);
  color: var(--btn-color);

  &:hover:not(:disabled) {
    background-color: var(--btn-hover-bg);
    border-color: var(--btn-hover-border);
    color: var(--btn-hover-color);
  }

  &:active:not(:disabled),
  &.active {
    background-color: var(--btn-active-bg);
    border-color: var(--btn-active-border);
    color: var(--btn-active-color);
  }

  &:disabled {
    background-color: var(--btn-disabled-bg);
    border-color: var(--btn-disabled-border);
    color: var(--btn-disabled-color);
    cursor: not-allowed;
    opacity: 0.65;
  }
}

/// Generate outline button variant
/// @param {Color} $color - Primary color
/// @param {Color} $hover-bg - Hover background (auto if null)
@mixin button-outline-variant($color, $hover-bg: null) {
  $hover-bg: if($hover-bg, $hover-bg, $color);

  --btn-bg: transparent;
  --btn-border: #{$color};
  --btn-color: #{$color};
  --btn-hover-bg: #{$hover-bg};
  --btn-hover-border: #{$hover-bg};
  --btn-hover-color: #{fn.color-contrast($hover-bg)};

  background-color: var(--btn-bg);
  border-color: var(--btn-border);
  color: var(--btn-color);

  &:hover:not(:disabled) {
    background-color: var(--btn-hover-bg);
    border-color: var(--btn-hover-border);
    color: var(--btn-hover-color);
  }
}

/// Button size variant
/// @param {Number} $padding-y - Vertical padding
/// @param {Number} $padding-x - Horizontal padding
/// @param {Number} $font-size - Font size
/// @param {Number} $border-radius - Border radius
@mixin button-size($padding-y, $padding-x, $font-size, $border-radius) {
  --btn-padding-y: #{$padding-y};
  --btn-padding-x: #{$padding-x};
  --btn-font-size: #{$font-size};
  --btn-border-radius: #{$border-radius};

  padding: var(--btn-padding-y) var(--btn-padding-x);
  font-size: var(--btn-font-size);
  border-radius: var(--btn-border-radius);
}

// --------------------------------------------
// Card Mixins
// --------------------------------------------

/// Card base styles
/// @param {Color} $bg - Background color
/// @param {Color} $border - Border color
/// @param {Number} $radius - Border radius
/// @param {String} $shadow - Box shadow
@mixin card(
  $bg: var(--card-bg, #fff),
  $border: var(--card-border, #e5e7eb),
  $radius: var(--card-radius, 0.5rem),
  $shadow: var(--card-shadow, 0 1px 3px rgb(0 0 0 / 0.1))
) {
  background-color: $bg;
  border: 1px solid $border;
  border-radius: $radius;
  box-shadow: $shadow;
}

/// Card with hover effect
@mixin card-hover($transform: translateY(-2px), $shadow: 0 4px 12px rgb(0 0 0 / 0.15)) {
  transition:
    transform 200ms ease,
    box-shadow 200ms ease;

  &:hover {
    transform: $transform;
    box-shadow: $shadow;
  }
}

// --------------------------------------------
// Form Mixins
// --------------------------------------------

/// Form input base styles
@mixin form-input {
  --input-bg: var(--form-input-bg, #fff);
  --input-border: var(--form-input-border, #d1d5db);
  --input-color: var(--form-input-color, #1f2937);
  --input-placeholder: var(--form-input-placeholder, #9ca3af);
  --input-focus-border: var(--form-input-focus-border, var(--primary, #3b82f6));
  --input-focus-ring: var(--form-input-focus-ring, rgb(59 130 246 / 0.25));

  display: block;
  width: 100%;
  padding: 0.5rem 0.75rem;
  font-size: 1rem;
  line-height: 1.5;
  color: var(--input-color);
  background-color: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 0.375rem;
  transition:
    border-color 150ms ease,
    box-shadow 150ms ease;

  &::placeholder {
    color: var(--input-placeholder);
  }

  &:focus {
    outline: none;
    border-color: var(--input-focus-border);
    box-shadow: 0 0 0 3px var(--input-focus-ring);
  }

  &:disabled {
    background-color: #f3f4f6;
    cursor: not-allowed;
    opacity: 0.6;
  }
}

/// Focus ring utility
/// @param {Color} $color - Ring color
/// @param {Number} $width - Ring width
/// @param {Number} $offset - Ring offset
@mixin focus-ring($color: var(--primary, #3b82f6), $width: 3px, $offset: 0) {
  &:focus {
    outline: none;
    box-shadow:
      0 0 0 $offset var(--bg-base, #fff),
      0 0 0 ($width + $offset) $color;
  }

  &:focus:not(:focus-visible) {
    box-shadow: none;
  }

  &:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 $offset var(--bg-base, #fff),
      0 0 0 ($width + $offset) $color;
  }
}

// --------------------------------------------
// Layout Mixins
// --------------------------------------------

/// Flexbox centering
@mixin flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

/// Flexbox space between
@mixin flex-between {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

/// Absolute positioning helpers
@mixin absolute-fill {
  position: absolute;
  inset: 0;
}

@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/// Container with max-width
/// @param {Number} $max-width - Maximum width
/// @param {Number} $padding - Horizontal padding
@mixin container($max-width: 1280px, $padding: 1rem) {
  width: 100%;
  max-width: $max-width;
  margin-inline: auto;
  padding-inline: $padding;
}

// --------------------------------------------
// Typography Mixins
// --------------------------------------------

/// Text truncation (single line)
@mixin text-truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/// Multi-line text truncation
/// @param {Number} $lines - Number of lines
@mixin line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/// Fluid typography
/// @param {Number} $min - Minimum font size in px
/// @param {Number} $max - Maximum font size in px
@mixin fluid-type($min, $max) {
  font-size: fn.fluid-type($min, $max);
}

// --------------------------------------------
// Utility Mixins
// --------------------------------------------

/// Visually hidden (accessible)
@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/// Reset list styles
@mixin list-reset {
  list-style: none;
  margin: 0;
  padding: 0;
}

/// Reset button styles
@mixin button-reset {
  appearance: none;
  background: none;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  font: inherit;
  color: inherit;
}

/// Clearfix
@mixin clearfix {
  &::after {
    content: '';
    display: table;
    clear: both;
  }
}

/// Transition shorthand
/// @param {List} $properties - Properties to transition
/// @param {Number} $duration - Duration
/// @param {String} $easing - Timing function
@mixin transition($properties: all, $duration: 200ms, $easing: ease) {
  $value: ();
  @each $prop in $properties {
    $value: append($value, $prop $duration $easing, comma);
  }
  transition: $value;
}
